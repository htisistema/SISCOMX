*********************************
* LISTAGEM MOVIMENTO PRODUTO P/MESES
*********************************
MEMVAR getlist,nivel_acess,m_compra

FUNCTION sac526(mestmin,mcodmerc,mtipocons)
**************
LOCAL MPRG:='SAC526',mtitulo,nxls:={}

PRIVATE mtraco,mtit,mtipo,mpag,;
        mtipo_imp,mimp_tipo:=0,marq:=SPACE(35),mcod_forn,morde_for:='N',;
        i,x,mdata:={},mqtd:={},mvlr:={},mcust:={},mexcl:={},;
        mgrupo,msubgrupo,mcod_ven,mcod_cli,mcodigo,mcod_ope,mpreco:=' ',mimp_mov:=SPACE(1),;
        mdias:=0,mqtd_mes:=0,mtip_cod:=' ',mresumo,;
        lba,cba,mtot_cust:=0,mest_cust:=0,mqtd1,mqtd2,mqtd3,mqtd4,;
        mexc_vend,mexc_cli,mexc_forn,q_merc:={},m_imprimir:={},mdia:='',mordem:=' ',;
        mdisp:='N',q_forn := {},curva_a:=0,curva_b:=0,mimp_a:=' ',mimp_b:=' ',;
        mimp_c := ' ',m_curva_a:={},m_curva_b:={},m_curva_c:={},mcompra_sn:='N',ult_qtd:={},so_qtd:='N',mop_cab:='S',;
        cons_cli:={},msoma_qtd:=0

IF mestmin = NIL
        mtitulo := 'RELATORIO DE MOVIMENTO PRODUTO P/MESES (CURVA A,B,C)'
	IF ! ver_nivel(mprg,mtitulo,'15',nivel_acess,,'AMBIE')
                RETURN NIL
        ENDIF
ELSE
	mtitulo := 'RELATORIO DE MOVIMENTO PRODUTO P/MESES'
        IF ! ver_nivel(mprg+'ESTMIN',mtitulo,'1',nivel_acess,,'AMBIE')
                RETURN NIL
        ENDIF
ENDIF

mtraco := REPLI('=',132)
lba := 22
cba := 70
*----------------------------------------------------------------------------
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
//
IF ! AbriArq('SACMOVNT','MOVNT');RETURN NIL;ENDIF
IF ! AbriArq('SACCLI','CLI');RETURN NIL;ENDIF
IF ! AbriArq('sacmov','mov');RETURN NIL;ENDIF
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF
IF ! AbriArq('sacgrupo','grup');RETURN NIL;ENDIF
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
*----------------------------------------------------------------------------
mtipo_imp := m_indiv[1,18]
op_tela(02,10,29,80,mtitulo)
WHILE .T.
        limpa(0,0,lba+2,cba)
        mqtd_mes := i := mgrupo := mcod_ope := mcod_ven := mcod_forn :=;
        mcod_cli:= mtot_cust := mest_cust := mqtd1 := mqtd2 := mqtd3 := mqtd4 := mexc_vend:=;
        mexc_cli:= mexc_forn := msubgrupo:=0
        curva_a :=500
        curva_b :=200
        md      :=90
        mdias   :=120
        mdata   :={}
        mqtd    :={}
        mvlr    :={}
        mcust   :={}
        mexcl   :={}
        m_curva_a:={}
        m_curva_b:={}
        m_curva_c:={}
        FOR i = 1 TO 4
                IF mtipocons = NIL
                        AADD(mdata,SUBSTR(DTOC(mdata_sis-md),04))
                        AADD(mqtd,0)
                        AADD(mvlr,0)
                        AADD(mcust,0)
                        AADD(mexcl,0)
                        md:=md - 30
                ELSE
                        AADD(mdata,'     ')
                        AADD(mqtd,0)
                        AADD(mvlr,0)
                        AADD(mcust,0)
                        AADD(mexcl,0)
                ENDIF
        NEXT
        msoma_qtd:=0
        mimp_mov := mop_cab := 'S'
	mcompra_sn := mdisp := so_qtd:='N'
        mtip_cod := m_set[1,147]
        mresumo := 'N'
        mordem := '4'
        mpreco := mtipo_cust := 'V'
        mimp_a := mimp_b := mimp_c := ' '
        mensagem('Preencha os Campos - <ESC>p/Abandonar')
        DEVPOS(0,2);DEVOUT('Imprmir Cabecalho:')
        DEVPOS(1,2);DEVOUT('Mes/Ano 1:         Mes/Ano 2:')
        DEVPOS(2,2);DEVOUT('Mes/Ano 3:         Mes/Ano 4:')
        DEVPOS(3,2);DEVOUT('Grupo............:')
        DEVPOS(4,2);DEVOUT('Sub-Grupo........:')
        DEVPOS(5,2);DEVOUT('Codigo Vendedor..:')
        DEVPOS(6,2);DEVOUT('Codigo Fornecedor:')
        DEVPOS(7,2);DEVOUT('Codigo Cliente...:')
        DEVPOS(8,2);DEVOUT('Codigo Operador..:')
        IF mestmin = NIL
                DEVPOS(9 ,2);DEVOUT('Preco: [V]enda [C]usto Mercadoria.............:')
                DEVPOS(10,2);DEVOUT('Imprimir Produtos s/Movimentos [S]im ou [N]ao.:')
                DEVPOS(11,2);DEVOUT('Quantidade de Dias p/Sugestao de Compra.......:')
                DEVPOS(12,2);DEVOUT('Tipo Codigo Produto [C]od.Sistema Cod.[B]arra.:')
                DEVPOS(13,2);DEVOUT('Imprimir por Ordem de FORNECEDOR [S]im - [N]ao:')
                DEVPOS(14,2);DEVOUT('Imprimir Relatorio RESUMIDO......[S]im - [N]ao:')
                DEVPOS(15,2);DEVOUT('Imprimir PRODUTO so c/necessidade Compra[S/N].:')
                @ 16,0 TO 16,cba
                DEVPOS(17,2);DEVOUT('Deseja Excluir Vendedor do Relatorio..........:')
                DEVPOS(18,2);DEVOUT('Deseja Excluir Cliente do Relatorio...........:')
                DEVPOS(19,2);DEVOUT('Deseja Excluir Fornecedor do Relatorio........:')
                DEVPOS(20,2);DEVOUT('Deseja Excluir PRODUTOS NAO DISPONIVEL........:')
                @ 21,0 TO 21,cba
                DEVPOS(22,2);DEVOUT('             LISTAR POR ORDEM')
                DEVPOS(23,2);DEVOUT('1-Alfa. 2-Quant. 3-Vlr.Vnd. 4-Vlr.cust 5-Grupo:')
                DEVPOS(24,2);DEVOUT('Valor da CURVA "A"............................:')
                DEVPOS(25,2);DEVOUT('Valor da CURVA "B"............................:')
                DEVPOS(26,2);DEVOUT('Imprmir SO AS QUANTIDADES [S/N]...............:')
                DEVPOS(27,2);DEVOUT('Imprmir  [V]alor Mercadoria [C]usto Mercadoria:')
        ENDIF
        @ 0,21 GET mop_cab PICT '@!' VALID mop_cab $ 'S,N'
        @ 1,13 GET mdata[1] PICT '99/99' VALID IF(EMPTY(mdata[1]) .AND. mtipocons = NIL,.F.,.T.)
        @ 1,32 GET mdata[2] PICT '99/99' WHEN ! EMPTY(mdata[1])
        @ 2,13 GET mdata[3] PICT '99/99' WHEN ! EMPTY(mdata[2])
        @ 2,32 GET mdata[4] PICT '99/99' WHEN ! EMPTY(mdata[3])
        @ 3,21 GET mgrupo PICT '999' VALID IF(EMPTY(mgrupo),.T.,ver_gru(@mgrupo,3,26,.F.))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        ver_gru(@mgrupo,3,26,.F.)
        @ 4,21 GET msubgrupo PICT '99' WHEN ! EMPTY(mgrupo) VALID IF(EMPTY(msubgrupo),.T.,ver_sgru(mgrupo,msubgrupo,4,26))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        ver_sgru(mgrupo,msubgrupo,4,26)
        @ 5,21 GET mcod_ven PICT '999' VALID IF(EMPTY(mcod_ven),.T.,ven(mcod_ven,5,26))
        @ 6,21 GET mcod_forn PICT '9999' VALID IF(EMPTY(mcod_forn),.T.,v_fornece(mcod_forn,6,26))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        v_fornece(mcod_forn,6,26)
        @ 7,21 GET mcod_cli PICT '99999' VALID ver_cli(mcod_cli,7,27)
        @ 8,21 GET mcod_ope PICT '999' VALID IF(EMPTY(mcod_ope),.T.,ven(mcod_ope,8,26))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF mestmin = NIL
                @ 9,50 GET mpreco PICT '@!' VALID mpreco $ 'V,C,M'
                @ 10,50 GET mimp_mov PICT '@!' VALID mimp_mov $ 'S,N'
                @ 11,50 GET mdias PICT '999'
                @ 12,50 GET mtip_cod PICT '@!' VALID mtip_cod $ 'C,B'
                @ 13,50 GET morde_for PICT '@!' VALID morde_for $ 'S,N' WHEN EMPTY(mcod_forn) .AND. mcodmerc = NIL
                @ 14,50 GET mresumo PICT '@!' VALID mresumo $ 'S,N'
                @ 15,50 GET mcompra_sn PICT '@!' VALID mcompra_sn $ 'S,N'

                @ 17,50 GET mexc_vend PICT '999' VALID IF(EMPTY(mexc_vend),.T.,ven(mexc_vend,17,54))
                @ 18,50 GET mexc_cli PICT '99999' VALID ver_cli(mexc_cli,18,56)
                @ 19,50 GET mexc_forn PICT '9999' VALID IF(EMPTY(mexc_forn),.T.,v_fornece(mexc_forn,19,55))
                @ 20,50 GET mdisp PICT '@!' VALID mdisp $ 'S,N'
                @ 23,50 GET mordem PICT '9' VALID mordem $ '1,2,3,4,5'
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                IF mordem <> '4'
                        curva_a := curva_b := 0
                ENDIF
                @ 24,50 GET curva_a PICT '999,999.99' WHEN mordem = '4'
                @ 25,50 GET curva_b PICT '999,999.99' WHEN ! EMPTY(curva_a) VALID IF(curva_a <= curva_b,.F.,.T.)
                @ 26,50 GET so_qtd PICT '@!' VALID so_qtd $ 'S,N'
                @ 27,50 GET mtipo_cust PICT '@!' VALID mtipo_cust $ 'V,C'
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
        ENDIF
        IF morde_for = 'S'
                forn_526()
                LOOP
        ENDIF
        IF mestmin = NIL .AND. mtipocons = NIL
                mensagem('Espere o Final da Impressao OK - [ESC]Abandonar')
                marq := 'MOV_MES.REL'
                IF ! imp_arq('MOV_MES.REL','R',,,,,,'E')
                        LOOP
                ENDIF
        ELSE
                IF mtipocons <> NIL
                        opcao := op_simnao('S','Confirma a Operacao:')
                ELSE
                        opcao := op_simnao('N','Confirma a Operacao:')
                ENDIF
                IF opcao = 'N' .OR. LASTKEY() = 27
                        LOOP
                ENDIF
        ENDIF
        i := 0
        FOR i = 1 TO 4
                IF ! EMPTY(mdata[i]) .AND. SUBSTR(mdata[i],1,2) <> SUBSTR(DTOC(mdata_sis),4,2)
                        mqtd_mes ++
                ENDIF
        NEXT

        q_forn := {}
        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
        sr_getconnection():exec('COMMIT',,.f.)

        m_imprimir :={}
        q_totais := {}
        cComm  := "SELECT SUM(saldo_mer),SUM(saldo_mer*cust_merc),SUM(saldo_mer*cust_real),SUM(saldo_mer*pr_venda) FROM sacmerc WHERE cod_merc IS NOT NULL AND (descont = 'N' OR descont IS NULL OR descont = ' ')"
        IF ! EMPTY(mgrupo)
                ccomm := ccomm + " AND gru_sub LIKE "+sr_cdbvalue(STRZERO(mgrupo,3)+'%')
        ENDIF
        IF ! EMPTY(msubgrupo)  
                cComm  := ccomm + " AND gru_sub = "+sr_cdbvalue(STRZERO(mgrupo,3)+STRZERO(msubgrupo,2))
        ENDIF
        IF ! EMPTY(mcod_forn)
                ccomm := ccomm + " AND cod_fab = "+sr_cdbvalue(STRZERO(mcod_forn,4))
        ENDIF
        IF mdisp = 'S'
                ccomm := ccomm + " AND disp = 'S'"
        ENDIF
        sr_getconnection():exec(ccomm,,.t.,@q_totais)
        sr_getconnection():exec('COMMIT',,.f.)


        q_merc := {}
        cComm  := "SELECT * FROM sacmerc WHERE cod_merc IS NOT NULL AND (descont = 'N' OR descont IS NULL OR descont = ' ')"
        IF ! EMPTY(mgrupo)
                ccomm := ccomm + " AND gru_sub LIKE "+sr_cdbvalue(STRZERO(mgrupo,3)+'%')
        ENDIF
        IF ! EMPTY(msubgrupo)  
                cComm  := ccomm + " AND gru_sub = "+sr_cdbvalue(STRZERO(mgrupo,3)+STRZERO(msubgrupo,2))
        ENDIF
        IF ! EMPTY(mcod_forn)
                ccomm := ccomm + " AND cod_fab = "+sr_cdbvalue(STRZERO(mcod_forn,4))
        ENDIF
        IF mdisp = 'S'
                ccomm := ccomm + " AND disp = 'S'"
        ENDIF
        IF mcodmerc <> NIL
                ccomm := ccomm + " AND cod_merc = "+sr_cdbvalue(STRZERO(mcodmerc,5))
        ENDIF
        ccomm := ccomm + " ORDER BY merc"
        sr_getconnection():exec(ccomm,,.t.,@q_merc)
        sr_getconnection():exec('COMMIT',,.f.)
        IF LEN(q_merc) = 0
                SETPRC(00,00)
                SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
                atencao('Nao existe documento neste Periodo...')
                LOOP
        ENDIF
        IF EMPTY(mdata[1]) .AND. EMPTY(mdata[2]) .AND. EMPTY(mdata[3]) .AND. EMPTY(mdata[4]) .AND. mtipocons <> NIL
                m:=0
                FOR m = 1 TO LEN(q_merc)
                        AADD(m_compra,{q_merc[m,8],q_merc[m,9],q_merc[m,2],q_merc[m,28],q_merc[m,33],q_merc[m,42],IF(mtipo_cust = 'V',q_merc[m,43],q_merc[m,44]),q_merc[m,56],mqtd[1],mqtd[2],mqtd[3],mqtd[4],mvlr[1],mvlr[2],mvlr[3],mvlr[4],0,0,q_merc[m,24],0,q_merc[m,14],q_merc[m,6],q_merc[m,7],q_merc[m,30],q_merc[m,31],mdata[1],mdata[2],mdata[3],mdata[4],0,0,q_merc[m,17],q_merc[m,61],q_merc[m,6]})
                NEXT
                wvw_lclosewindow()
                RETURN NIL
        ENDIF

        mtit = 'Listagem de Produto p/Meses'
        mtipo := 'Meses: '+mdata[1]+', '+mdata[2]+', '+mdata[3]+', '+mdata[4]
        mpag := m:=0
        FOR m = 1 TO LEN(q_merc)
                mensagem('Calculando o Produto: '+q_merc[m,8]+' - '+q_merc[m,9]+'  Aguarde um momento ...')
                i := 0
                FOR i = 1 TO 4  //mqtd_mes
                        IF EMPTY(mdata[i])
                                LOOP
                        ENDIF

                        q_mov:={}
                        cComm  := "SELECT SUM(quantd) "
                        IF mpreco = 'V'
                                ccomm := ccomm +",SUM(vl_fatura * quantd)"
                        ELSEIF mpreco = 'C'
                                ccomm := ccomm +",SUM(pr_unit * quantd)"
                        ELSE
                                ccomm := ccomm +",SUM(pr_unit * quantd)"
                        ENDIF
                        ccomm := ccomm +",SUM(pr_unit * quantd)"
                        ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL AND NOT tipo = '01' AND ent_sai = 'S' AND documento NOT LIKE 'BL%'"
                        IF ! EMPTY(mcod_cli)
                                ccomm := ccomm + " AND cod_cli = "+sr_cdbvalue(mcod_cli)
                        ENDIF
                        IF ! EMPTY(mcod_ven)
                                ccomm := ccomm + " AND cod_vend = "+sr_cdbvalue(STRZERO(mcod_ven,3))
                        ENDIF
                        IF ! EMPTY(mcod_ope)
                                ccomm := ccomm + " AND cod_oper = "+sr_cdbvalue(STRZERO(mcod_ope,3))
                        ENDIF
                        IF ! EMPTY(mexc_forn)
                                ccomm := ccomm + " AND NOT cod_fab = "+sr_cdbvalue(STRZERO(mexc_forn,4))
                        ENDIF
                        IF ! EMPTY(mexc_cli)
                                ccomm := ccomm + " AND NOT cod_cli = "+sr_cdbvalue(STRZERO(mexc_cli,5))
                        ENDIF
                        IF ! EMPTY(mexc_vend)
                                ccomm := ccomm + " AND NOT cod_vend = "+sr_cdbvalue(STRZERO(mexc_vend,3))
                        ENDIF
                        ccomm := ccomm + " AND data_s_e >= "+sr_cdbvalue('20'+SUBSTR(mdata[i],4,2)+'/'+SUBSTR(mdata[i],1,2)+'/01')
                        mdia := ''
                        IF SUBSTR(mdata[i],1,2) = '01' .OR. SUBSTR(mdata[i],1,2) = '03' .OR. SUBSTR(mdata[i],1,2) = '05' .OR. SUBSTR(mdata[i],1,2)='07' .OR. SUBSTR(mdata[i],1,2)='08' .OR. SUBSTR(mdata[i],1,2) = '10' .OR. SUBSTR(mdata[i],1,2) = '12'
                                mdia := '30'
                        ELSEIF SUBSTR(mdata[i],1,2) = '02'
                                mdia := '28'
                        ELSE
                                mdia := '30'
                        ENDIF
                        ccomm := ccomm + " AND data_s_e <= "+sr_cdbvalue('20'+SUBSTR(mdata[i],4,2)+'/'+SUBSTR(mdata[i],1,2)+'/'+mdia)
                        ccomm := ccomm + " AND codigo = "+sr_cdbvalue(q_merc[m,8])
                        //ccomm := ccomm + " ORDER BY produto"
                        sr_getconnection():exec(ccomm,,.t.,@q_mov)
                        sr_getconnection():exec('COMMIT',,.f.)
                        IF LEN(q_mov) = 0
                                LOOP
                        ENDIF
                        mqtd[i] :=q_mov[1,1]
                        mvlr[i] :=q_mov[1,2]
                        //IF mpreco = 'M'
                        //        mcust[i]:=q_mov[1,1] * q_merc[m,43]
                        //ELSE
                                mcust[i]:=q_mov[1,3]
                        //ENDIF

                NEXT
                //atencao(TRANSFORM(mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4],'999,999,999.99'))
                IF mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4] > 0 .OR. mimp_mov = 'S'
                        IF mestmin = NIL
                                IF mtipocons <> NIL
                                        msoma_qtd := msoma_qtd + mqtd[1]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + mqtd[2]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + mqtd[3]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + mqtd[4]
                                        ENDIF
                                        IF ! (((msoma_qtd/mqtd_mes) * (mdias/30))-q_merc[m,56] < 0 ;
                                                .AND. mcompra_sn = 'S')
                                                AADD(m_compra  ,{q_merc[m,8],q_merc[m,9],q_merc[m,2],q_merc[m,28],q_merc[m,33],q_merc[m,42],IF(mtipo_cust = 'V',q_merc[m,43],q_merc[m,44]),q_merc[m,56],mqtd[1],mqtd[2],mqtd[3],mqtd[4],mvlr[1],mvlr[2],mvlr[3],mvlr[4],mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4],(mvlr[1]+mvlr[2]+mvlr[3]+mvlr[4])/mqtd_mes,q_merc[m,24],(mcust[1]+mcust[2]+mcust[3]+mcust[4])/mqtd_mes,q_merc[m,14],q_merc[m,6],q_merc[m,7],q_merc[m,30],q_merc[m,31],mdata[1],mdata[2],mdata[3],mdata[4],mqtd_mes,mdias,q_merc[m,17],q_merc[m,61],q_merc[m,6]})
                                        ENDIF
                                ELSE
                                                //             1          2           3            4            5             6                             7                          8         9      10      11      12      13      14      15      16                 17                                  18                             19                          20                              21         22       
                                        AADD(m_imprimir,{q_merc[m,8],q_merc[m,9],q_merc[m,2],q_merc[m,28],q_merc[m,33],q_merc[m,42],IF(mtipo_cust = 'V',q_merc[m,43],q_merc[m,44]),q_merc[m,56],mqtd[1],mqtd[2],mqtd[3],mqtd[4],mvlr[1],mvlr[2],mvlr[3],mvlr[4],mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4],(mvlr[1]+mvlr[2]+mvlr[3]+mvlr[4])/mqtd_mes,q_merc[m,24],(mcust[1]+mcust[2]+mcust[3]+mcust[4])/mqtd_mes,q_merc[m,7],q_merc[m,6]})
                                ENDIF
                                        
                        ENDIF
                ENDIF
                x := 0
                FOR x = 1 TO 4
                        mqtd[x]  := 0
                        mvlr[x]  := 0
                        mcust[x] := 0
                NEXT
        NEXT
        IF mtipocons <> NIL
                wvw_lclosewindow()
                RETURN NIL
        ENDIF
        IF mestmin = NIL
		IF mordem = '1'
                        ASORT(m_imprimir,,, {|z,y| y[2] > z[2]})
                        IF mimp_tipo = 4
                                nxls := {}
                                f:=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                MYRUN('DEL '+marq)
                                nXls := xlsOpen(marq)
                                IF ! EMPTY(mcod_forn)
                                        q_forn := {}
                                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                        sr_getconnection():exec('COMMIT',,.f.)
                                        xlsWrite( nXls, f, 1,'Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                        f++
                                        xlsWrite( nXls, f, 1,'Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                        f++                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                xlsWrite( nXls, f, 1, 'Codigo' )
                                xlsWrite( nXls, f, 2, 'Produto' )
                                xlsWrite( nXls, f, 3, '  Saldo' )
                                xlsWrite( nXls, f, 4, ' Pr.Custo')
                                xlsWrite( nXls, f, 5, ' '+mdata[1])
                                xlsWrite( nXls, f, 6, ' '+mdata[2])
                                xlsWrite( nXls, f, 7, ' '+mdata[3])
                                xlsWrite( nXls, f, 8, ' '+mdata[4])
                                xlsWrite( nXls, f, 9, ' Tot.Mes ')
                                xlsWrite( nXls, f, 10, 'Med.'+STRZERO(mqtd_mes,1)+' MES')
                                xlsWrite( nXls, f, 11, 'Med.Vlr.Custo')
                                xlsWrite( nXls, f, 12, 'Sugestao Compra')
                                xlsWrite( nXls, f, 13, 'Disponivel')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                f++
                                m:=0
                                FOR m = 1 TO LEN(m_imprimir)
                                        mensagem('IMPRIMINDO PARA EXCEL o Produto: '+m_imprimir[m,1]+' - '+m_imprimir[m,2]+'  Aguarde um momento ...')
                                        msoma_qtd := m_imprimir[m,9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                        IF mqtd_mes > 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                msoma_qtd := msoma_qtd + m_imprimir[m,10]
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        IF mqtd_mes > 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                msoma_qtd := msoma_qtd + m_imprimir[m,11]                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        IF mqtd_mes > 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                msoma_qtd := msoma_qtd + m_imprimir[m,12]                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        xlsWrite( nXls, f, 1, m_imprimir[m,1] )
                                        xlsWrite( nXls, f, 2, m_imprimir[m,2] )
                                        xlsWrite( nXls, f, 3, ALLTRIM(TRANSFORM(m_imprimir[m,8],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                        xlsWrite( nXls, f, 4, ALLTRIM(TRANSFORM(m_imprimir[m,7],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                        xlsWrite( nXls, f, 5, ALLTRIM(TRANSFORM(m_imprimir[m,9],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                        mqtd1 := mqtd1 + m_imprimir[m,9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                        IF ! EMPTY(mdata[2])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                mqtd2 := mqtd2 + m_imprimir[m,10]                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(m_imprimir[m,10],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')))                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        IF ! EMPTY(mdata[3])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                mqtd3 := mqtd3 + m_imprimir[m,11]                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(m_imprimir[m,11],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        IF ! EMPTY(mdata[4])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                mqtd4 := mqtd4 + m_imprimir[m,12]                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(m_imprimir[m,12],'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                        ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                        xlsWrite( nXls, f, 9, ALLTRIM(TRANSFORM(msoma_qtd,'@E 999,999.99')) )                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                        xlsWrite( nXls, f, 10, ALLTRIM(TRANSFORM(msoma_qtd/mqtd_mes,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 11, ALLTRIM(TRANSFORM(m_imprimir[m,20],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 12, ALLTRIM(TRANSFORM(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8]),'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 13, m_imprimir[m,19] )                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                        f++                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                NEXT
        	                xlsClose( nXls )
                        ELSE 

		                mensagem('Aguarde um momento Imprimindo o Relatorio .....')
	                        IF mpag = 0 .OR. PROW() >= 59
        	                        mpag ++
                	                IF mpag > 1 ;EJECT;ENDIF
                        	        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                                	imprt(mtipo_imp,'C')
	                                IF ! EMPTY(mcod_forn)
        	                                q_forn := {}
                	                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                sr_getconnection():exec('COMMIT',,.f.)
                        	                DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                	        DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                        	DEVPOS(PROW()+1,00);DEVOUT(mtraco)
	                                ENDIF
        	                        DEVPOS(PROW()+1,47);DEVOUT('       ')
					IF so_qtd = 'N'
                	                	DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
                	                ENDIF
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
	                                DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
        	                        DEVPOS(PROW()+1,00);DEVOUT('Produto')
                	                DEVPOS(PROW(),47);DEVOUT('   Saldo ')
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
					IF so_qtd = 'N'
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
        		                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
                		      	ENDIF
                        	        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
	                        ENDIF
                                m:=0
                                FOR m = 1 TO LEN(m_imprimir)
                                        msoma_qtd := m_imprimir[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_imprimir[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_imprimir[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_imprimir[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8] < 0 ;
                                            .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        DEVPOS(PROW()+1,00);DEVOUT(m_imprimir[m,1])
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_imprimir[m,2])

                                        DEVPOS(PROW(),47);DEVOUT(IF(m_imprimir[m,8] <= 0,'*','|'))
                                        DEVPOS(PROW(),PCOL());DEVOUTPICT(m_imprimir[m,8],'999,999')
                                        DEVPOS(PROW(),PCOL());DEVOUT(IF(m_imprimir[m,8] <= 0,'*','|'))

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(m_imprimir[m,7],'99,999.99')
	                               	ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_imprimir[m,9],'99,999'))
                                        mqtd1 := mqtd1 + m_imprimir[m,9]
                                        IF ! EMPTY(mdata[2])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_imprimir[m,10],'99,999'))
                                                mqtd2 := mqtd2 + m_imprimir[m,10]
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF

                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_imprimir[m,11]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_imprimir[m,11],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_imprimir[m,12]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_imprimir[m,12],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('|')
                                        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(msoma_qtd,'999,999'))
                                        DEVPOS(PROW(),PCOL());DEVOUT('|')

                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(msoma_qtd/mqtd_mes,'999,999')

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_imprimir[m,20],'99,999.99'))
        	                                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_imprimir[m,8]),'99,999')
                	                        DEVPOS(PROW(),PCOL()+2);DEVOUT(m_imprimir[m,19])
                	               	ENDIF
                                        IF ver_serie() = '141473'
                                                DEVPOS(PROW()+1,00);DEVOUT('Ref.Fab.: '+m_imprimir[m,22])
                                        ENDIF
                                        IF mresumo = 'N'
                                                ult_qtd:={}
                                                cComm  := "SELECT * "
                                                ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL  AND ent_sai = 'E' AND (documento LIKE 'NF%' OR documento LIKE 'PD%')"
                                                ccomm := ccomm + " AND codigo = "+sr_cdbvalue(m_imprimir[m,1])
                                                ccomm := ccomm + " ORDER BY data_s_e "
                                                //ccomm := ccomm + " AND data_s_e = "+sr_cdbvalue(m_curva_a[m,5])
                                                sr_getconnection():exec(ccomm,,.t.,@ult_qtd)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                                IF LEN(ult_qtd) = 0
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('  /  /  ')
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(0,'99,999.99')
                                                ELSE
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(ult_qtd[LEN(ult_qtd),16])
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(ult_qtd[LEN(ult_qtd),19],'99,999.99')
                                                ENDIF
                                        ENDIF

                                        mtot_cust := mtot_cust + m_imprimir[m,20]
                                        mest_cust := mest_cust + (m_imprimir[m,8] * m_imprimir[m,7])
                                        IF mpag = 0 .OR. PROW() >= 59
                                                mpag ++
                                                IF mpag > 1 ;EJECT;ENDIF
                                	        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                                                //cabecalho(mpag,mtit,mtipo,mprg)
                                                imprt(mtipo_imp,'C')
                                                IF ! EMPTY(mcod_forn)
                                                        q_forn := {}
                                                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                        sr_getconnection():exec('COMMIT',,.f.)
                                                        DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                                        DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                                ENDIF
                                                DEVPOS(PROW()+1,47);DEVOUT('       ')
						IF so_qtd = 'N'
                                                	DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
                                                ENDIF
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                                	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
                                        	DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
     	                                        DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
                                                DEVPOS(PROW()+1,00);DEVOUT('Produto')
                                                DEVPOS(PROW(),47);DEVOUT('   Saldo ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
						IF so_qtd = 'N'
        	                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
                	                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
                        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
                        	               	ENDIF
                                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                        ENDIF
                                NEXT
                        	DEVPOS(PROW()+1,00);DEVOUT(mtraco)
				IF so_qtd = 'N'
	                                //DEVPOS(PROW()+1,00);DEVOUT('TOTAIS:  Estoque Preco Custo: '+TRANSFORM(mest_cust,'9,999,999.99'))
        	                        DEVPOS(PROW()+1,65);DEVOUT(TRANSFORM(mqtd1,'99,999'))
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd2,'99,999'))
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd3,'99,999'))
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd4,'99,999'))
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd1+mqtd2+mqtd3+mqtd4,'999,999'))
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM((mqtd1+mqtd2+mqtd3+mqtd4)/mqtd_mes,'999,999'))
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot_cust,'9,999,999.99'))
                	       	ENDIF
                                DEVPOS(PROW()+2,00);DEVOUT('Total de Item.......:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(LEN(m_imprimir),'999,999'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Total em Volumes:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,1],'999,999.99'))
                                DEVPOS(PROW()+1,00);DEVOUT('Total Custo Mercad..:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,2],'99,999,999.99'))
                                DEVPOS(PROW()+1,00);DEVOUT('Total preco de custo:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,3],'99,999,999.99'))
                                DEVPOS(PROW()+1,00);DEVOUT('Total preco de venda:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,4],'999,999,999.99'))
                                DEVPOS(PROW()+2,00);DEVOUT(TIME())
                                imprt(mtipo_imp,'N')
                                EJECT
                                SETPRC(00,00)
                                SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
		        ENDIF
                        conf_impressao(marq)
                	LOOP
		ELSEIF mordem = '2'
                        ASORT(m_imprimir,,, {|z,y| z[17] > y[17]})
                ELSEIF mordem = '3'
                        ASORT(m_imprimir,,, {|z,y| z[18] > y[18]})
                ELSEIF mordem = '4'
                        ASORT(m_imprimir,,, {|z,y| z[20] > y[20]})
                ELSEIF mordem = '5'
                        //ASORT(m_imprimir,,, {|z,y| z[2] < y[2]})
                        ASORT(m_imprimir,,, {|z,y| z[21]+z[2] < y[21]+y[2]})
                ENDIF
                m:=0
                FOR m = 1 TO LEN(m_imprimir)
                        mensagem('COLETANDO DADOS PARA O RELATORIO: '+m_imprimir[m,1]+' - '+m_imprimir[m,2]+'  Aguarde um momento ...')

                        //IF ! EMPTY(curva_a) .AND. curva_a <= m_imprimir[m,17]
                        //        AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20]})
                        //ENDIF
                        IF mordem = '1' .AND. m_imprimir[m,20] >= curva_a
                                AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '2' .AND. m_imprimir[m,20] >= curva_a
                                AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '2' .AND. m_imprimir[m,17] < curva_a .AND. m_imprimir[m,17] >= curva_b
                                AADD(m_curva_b,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '2' .AND. m_imprimir[m,17] < curva_b
                                AADD(m_curva_c,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '3' .AND. m_imprimir[m,20] >= curva_a
                                AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '3' .AND. m_imprimir[m,18] < curva_a .AND. m_imprimir[m,18] >= curva_b
                                AADD(m_curva_b,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '3' .AND. m_imprimir[m,18] < curva_b
                                AADD(m_curva_c,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '4' .AND. m_imprimir[m,20] >= curva_a
                                AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '4' .AND. m_imprimir[m,20] < curva_a .AND. m_imprimir[m,20] > curva_b
                                AADD(m_curva_b,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '4' .AND. m_imprimir[m,20] < curva_b
                                AADD(m_curva_c,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ELSEIF mordem = '5'
                                AADD(m_curva_a,{m_imprimir[m,1],m_imprimir[m,2],m_imprimir[m,3],m_imprimir[m,4],m_imprimir[m,5],m_imprimir[m,6],m_imprimir[m,7],m_imprimir[m,8],m_imprimir[m,9],m_imprimir[m,10],m_imprimir[m,11],m_imprimir[m,12],m_imprimir[m,13],m_imprimir[m,14],m_imprimir[m,15],m_imprimir[m,16],m_imprimir[m,17],m_imprimir[m,18],m_imprimir[m,19],m_imprimir[m,20],m_imprimir[m,21],m_imprimir[m,22]})
                        ENDIF
                NEXT
                mensagem('Aguarde um momento Imprimindo o Relatorio .....')
		IF mimp_tipo = 4
                        f:=1
                        MYRUN('DEL '+marq)
                        nXls := xlsOpen( marq )
                        IF ! EMPTY(mcod_forn)
                                q_forn := {}
                                sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                sr_getconnection():exec('COMMIT',,.f.)
                                xlsWrite( nXls, f, 1,'Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                f++
                                xlsWrite( nXls, f, 1,'Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                f++
                        ENDIF
                        xlsWrite( nXls, f, 1, 'Codigo' )
                        xlsWrite( nXls, f, 2, 'Produto' )
                        xlsWrite( nXls, f, 3, '  Saldo' )
                        xlsWrite( nXls, f, 4, ' Pr.Custo')
                        xlsWrite( nXls, f, 5, ' '+mdata[1])
                        xlsWrite( nXls, f, 6, ' '+mdata[2])
                        xlsWrite( nXls, f, 7, ' '+mdata[3])
                        xlsWrite( nXls, f, 8, ' '+mdata[4])
                        xlsWrite( nXls, f, 9, 'Tot.Mes')
                        xlsWrite( nXls, f, 10, 'Med.'+STRZERO(mqtd_mes,1)+' MES')
                        xlsWrite( nXls, f, 11, 'Med.Vlr.Custo')
                        xlsWrite( nXls, f, 12, 'Sugestao Compra')
                        xlsWrite( nXls, f, 13, 'Disponivel')
                        f++
	                mpag := m:=0
                        IF ! EMPTY(m_curva_a)
                                ASORT(m_curva_a,,, {|z,y| y[2] > z[2]})
                                xlsWrite( nXls, f, 4, '1o.CURVA "A" Acima de R$: '+ALLTRIM(TRANSFORM(curva_a,'@E 999,999.99')) )
                                f++
                                m:=0
                                FOR m = 1 TO LEN(m_curva_a)
                                        mensagem('IMPRIMINDO o Produto: '+m_curva_a[m,1]+' - '+m_curva_a[m,2]+'  Aguarde um momento ...')
                                        msoma_qtd := m_curva_a[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_a[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_a[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_a[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF

                                        xlsWrite( nXls, f, 1, m_curva_a[m,1] )
                                        xlsWrite( nXls, f, 2, m_curva_a[m,2] )
                                        xlsWrite( nXls, f, 3, ALLTRIM(TRANSFORM(m_curva_a[m,8],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 4, ALLTRIM(TRANSFORM(m_curva_a[m,7],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 5, ALLTRIM(TRANSFORM(m_curva_a[m,9],'@E 999,999.99')) )
                                        mqtd1 := mqtd1 + m_curva_a[m,9]
                                        IF ! EMPTY(mdata[2])
                                                mqtd2 := mqtd2 + m_curva_a[m,10]
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(m_curva_a[m,10],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')))
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_a[m,11]
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(m_curva_a[m,11],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_a[m,12]
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(m_curva_a[m,12],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF

                                        xlsWrite( nXls, f, 9, ALLTRIM(TRANSFORM(msoma_qtd,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 10, ALLTRIM(TRANSFORM(msoma_qtd/mqtd_mes,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 11, ALLTRIM(TRANSFORM(m_curva_a[m,20],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 12, ALLTRIM(TRANSFORM(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8]),'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 13, m_curva_a[m,19] )
                                        f++
                                NEXT
                        ENDIF
                        IF ! EMPTY(m_curva_b)
                                ASORT(m_curva_b,,, {|z,y| y[2] > z[2]})
                                xlsWrite( nXls, f, 4, '2o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'@E 999,999.99')) )
                                f++
                                m:=0
                                FOR m = 1 TO LEN(m_curva_b)
                                        mensagem('IMPRIMINDO o Produto: '+m_curva_b[m,1]+' - '+m_curva_b[m,2]+'  Aguarde um momento ...')
                                        msoma_qtd := m_curva_b[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_b[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_b[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_b[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        xlsWrite( nXls, f, 1, m_curva_b[m,1] )
                                        xlsWrite( nXls, f, 2, m_curva_b[m,2] )
                                        xlsWrite( nXls, f, 3, ALLTRIM(TRANSFORM(m_curva_b[m,8],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 4, ALLTRIM(TRANSFORM(m_curva_b[m,7],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 5, ALLTRIM(TRANSFORM(m_curva_b[m,9],'@E 999,999.99')) )
                                        mqtd1 := mqtd1 + m_curva_b[m,9]
                                        IF ! EMPTY(mdata[2])
                                                mqtd2 := mqtd2 + m_curva_b[m,10]
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(m_curva_b[m,10],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')))
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_b[m,11]
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(m_curva_b[m,11],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_b[m,12]
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(m_curva_b[m,12],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF
                                        xlsWrite( nXls, f, 9, ALLTRIM(TRANSFORM(msoma_qtd,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 10, ALLTRIM(TRANSFORM(msoma_qtd/mqtd_mes,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 11, ALLTRIM(TRANSFORM(m_curva_b[m,20],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 12, ALLTRIM(TRANSFORM(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8]),'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 13, m_curva_b[m,19] )
                                        f++
                                NEXT
                        ENDIF
                        IF ! EMPTY(m_curva_c)
                                ASORT(m_curva_c,,, {|z,y| y[2] > z[2]})
                                xlsWrite( nXls, f, 4, '3o.CURVA "C" Abaixo de R$: '+ALLTRIM(TRANSFORM(curva_b - 0.01,'@E 999,999.99')) )
                                f++
                                m:=0
                                FOR m = 1 TO LEN(m_curva_c)
                                        mensagem('IMPRIMINDO o Produto: '+m_curva_c[m,1]+' - '+m_curva_c[m,2]+'  Aguarde um momento ...')
                                        msoma_qtd := m_curva_c[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_c[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_c[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_c[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        xlsWrite( nXls, f, 1, m_curva_c[m,1] )
                                        xlsWrite( nXls, f, 2, m_curva_c[m,2] )
                                        xlsWrite( nXls, f, 3, ALLTRIM(TRANSFORM(m_curva_c[m,8],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 4, ALLTRIM(TRANSFORM(m_curva_c[m,7],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 5, ALLTRIM(TRANSFORM(m_curva_c[m,9],'@E 999,999.99')) )
                                        mqtd1 := mqtd1 + m_curva_c[m,9]
                                        IF ! EMPTY(mdata[2])
                                                mqtd2 := mqtd2 + m_curva_c[m,10]
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(m_curva_c[m,10],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 6, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')))
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_c[m,11]
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(m_curva_c[m,11],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 7, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_c[m,12]
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(m_curva_c[m,12],'@E 999,999.99')) )
                                        ELSE
                                                xlsWrite( nXls, f, 8, ALLTRIM(TRANSFORM(0.00,'@E 999,999.99')) )
                                        ENDIF
                                        xlsWrite( nXls, f, 9, ALLTRIM(TRANSFORM(msoma_qtd,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 10, ALLTRIM(TRANSFORM(msoma_qtd/mqtd_mes,'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 11, ALLTRIM(TRANSFORM(m_curva_c[m,20],'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 12, ALLTRIM(TRANSFORM(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8]),'@E 999,999.99')) )
                                        xlsWrite( nXls, f, 13, m_curva_c[m,19] )
                                        f++
                                NEXT
                        ENDIF
                ELSE
                        IF mpag = 0 .OR. PROW() >= 59
                		IF (mop_cab = 'N' .AND. mpag = 0) .OR. mop_cab = 'S'
	                		mpag ++
        	                        IF mpag > 1 ;EJECT;ENDIF
                	        	cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                        	        //cabecalho(mpag,mtit,mtipo,mprg)
	                                imprt(mtipo_imp,'C')
        	                        IF ! EMPTY(mcod_forn)
                	                        q_forn := {}
                        	                sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                	        DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                        	DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
	                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        	                        ENDIF
                	                DEVPOS(PROW()+1,47);DEVOUT('       ')
					IF so_qtd = 'N'
	                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
		                       	ENDIF
		                       	DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                	 	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
					IF so_qtd = 'N'
	                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
			                        DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
			              	ENDIF
                	                DEVPOS(PROW()+1,00);DEVOUT('Produto')
                        	        DEVPOS(PROW(),47);DEVOUT('   Saldo ')
					IF so_qtd = 'N'
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
	                                ENDIF
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
                	                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                                	DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
        	                        DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
					IF so_qtd = 'N'
	                	                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
	                        	        DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
        	                        	DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
	        	               	ENDIF
        	                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                	       	ENDIF
                        ENDIF
                        IF ! EMPTY(m_curva_a)
		                imprt(mtipo_imp,'N')
                                imprt(mtipo_imp,'W1')
                                imprt(mtipo_imp,'N+')
                		IF mordem = '1'
		                        ASORT(m_curva_a,,, {|z,y| z[2] > y[2]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "A" Acima de R$: '+ALLTRIM(TRANSFORM(curva_a,'999,999.99')))
                		ELSEIF mordem = '2'
		                        ASORT(m_curva_a,,, {|z,y| z[17] > y[17]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "A" Acima de R$: '+ALLTRIM(TRANSFORM(curva_a,'999,999.99')))
		                ELSEIF mordem = '3'
		                        ASORT(m_curva_a,,, {|z,y| z[18] > y[18]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "A" Acima de R$: '+ALLTRIM(TRANSFORM(curva_a,'999,999.99')))
		                ELSEIF mordem = '4'
		                        ASORT(m_curva_a,,, {|z,y| z[20] > y[20]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "A" Acima de R$: '+ALLTRIM(TRANSFORM(curva_a,'999,999.99')))
		                ELSEIF mordem = '5'
		                        ASORT(m_curva_a,,, {|z,y| z[21]+z[2] < y[21]+y[2]})
                                        mcod_grupo := '     '
		                ENDIF

                                imprt(mtipo_imp,'N-')
                                imprt(mtipo_imp,'W0')
                                imprt(mtipo_imp,'C')
                                mimp_a := '1'
                                m:=0
                                FOR m = 1 TO LEN(m_curva_a)
                                        IF mordem = '5'
                                                IF mcod_grupo <> m_curva_a[m,21]
                                                        DEVPOS(PROW()+1,0);DEVOUT('GRUPO: '+SUBSTR(m_curva_a[m,21],1,3))
                                                        ver_gru(VAL(SUBSTR(m_curva_a[m,21],1,3)),PROW(),PCOL()+1)
                                                        DEVPOS(PROW(),PCOL()+3);DEVOUT('SUB-GRUPO: '+SUBSTR(m_curva_a[m,21],4))
                                                        ver_sgru(VAL(SUBSTR(m_curva_a[m,21],1,3)),VAL(SUBSTR(m_curva_a[m,21],4)),PROW(),PCOL()+1)
                                                        mcod_grupo := m_curva_a[m,21]
                                                ENDIF
                                        ENDIF
                                        msoma_qtd := m_curva_a[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_a[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_a[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_a[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        DEVPOS(PROW()+1,00);DEVOUT(m_curva_a[m,1])
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_curva_a[m,2])

                                        DEVPOS(PROW(),47);DEVOUT(IF(m_curva_a[m,8] <= 0,'*','|'))
                                        DEVPOS(PROW(),PCOL());DEVOUTPICT(m_curva_a[m,8],'999,999')
                                        DEVPOS(PROW(),PCOL());DEVOUT(IF(m_curva_a[m,8] <= 0,'*','|'))

					IF so_qtd = 'N'
        	                                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(m_curva_a[m,7],'99,999.99')
        	                       	ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_a[m,9],'99,999'))
                                        mqtd1 := mqtd1 + m_curva_a[m,9]
                                        IF ! EMPTY(mdata[2])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_a[m,10],'99,999'))
                                                mqtd2 := mqtd2 + m_curva_a[m,10]
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_a[m,11]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_a[m,11],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_a[m,12]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_a[m,12],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('|')
                                        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(msoma_qtd,'999,999'))
                                        DEVPOS(PROW(),PCOL());DEVOUT('|')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(msoma_qtd/mqtd_mes,'999,999')

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_a[m,20],'99,999.99'))
        	                                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_a[m,8]),'99,999')
                	                        DEVPOS(PROW(),PCOL()+2);DEVOUT(m_curva_a[m,19])
                	               	ENDIF
                                        IF ver_serie() = '141473'
                                                DEVPOS(PROW()+1,00);DEVOUT('Ref.Fab.: '+m_curva_a[m,22])
                                        ENDIF

                                        IF mresumo = 'N'
                                                ult_qtd:={}
                                                cComm  := "SELECT * "
                                                ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL  AND ent_sai = 'E' AND (documento LIKE 'NF%' OR documento LIKE 'PD%')"
                                                ccomm := ccomm + " AND codigo = "+sr_cdbvalue(m_curva_a[m,1])
                                                ccomm := ccomm + " ORDER BY data_s_e "
                                                //ccomm := ccomm + " AND data_s_e = "+sr_cdbvalue(m_curva_a[m,5])
                                                sr_getconnection():exec(ccomm,,.t.,@ult_qtd)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                                IF LEN(ult_qtd) = 0
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('  /  /  ')
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(0,'99,999.99')
                                                ELSE
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(ult_qtd[LEN(ult_qtd),16])
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(ult_qtd[LEN(ult_qtd),19],'99,999.99')
                                                ENDIF
                                        ENDIF
                                        mtot_cust := mtot_cust + m_curva_a[m,20]
                                        mest_cust := mest_cust + (m_curva_a[m,8] * m_curva_a[m,7])
                                        IF mpag = 0 .OR. PROW() >= 59
		                		IF (mop_cab = 'N' .AND. mpag = 0) .OR. mop_cab = 'S'
                                                mpag ++
                                                IF mpag > 1 ;EJECT;ENDIF
                                	        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                                                //cabecalho(mpag,mtit,mtipo,mprg)
                                                imprt(mtipo_imp,'C')
                                                IF ! EMPTY(mcod_forn)
                                                        q_forn := {}
                                                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                        sr_getconnection():exec('COMMIT',,.f.)
                                                        DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                                        DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                                ENDIF
		                                DEVPOS(PROW()+1,47);DEVOUT('       ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
			                       	ENDIF
	        		               	DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
		                 	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
				                        DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
				              	ENDIF
                                		DEVPOS(PROW()+1,00);DEVOUT('Produto')
		                                DEVPOS(PROW(),47);DEVOUT('   Saldo ')
						IF so_qtd = 'N'
                                			DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
		                                ENDIF
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
			                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
        			                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
        	               			ENDIF
		                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
		                                ENDIF
                                        ENDIF
                                NEXT
                        ENDIF

                        IF ! EMPTY(m_curva_b)
                                
				//ASORT(m_curva_b,,, {|z,y| y[2] > z[2]})
                                imprt(mtipo_imp,'N')
                                imprt(mtipo_imp,'W1')
                                imprt(mtipo_imp,'N+')
                		IF mordem = '1'
		                        ASORT(m_curva_b,,, {|z,y| z[2] > y[2]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'999,999.99')))
                		ELSEIF mordem = '2'
		                        ASORT(m_curva_b,,, {|z,y| z[17] > y[17]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'999,999.99')))
		                ELSEIF mordem = '3'
		                        ASORT(m_curva_b,,, {|z,y| z[18] > y[18]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'999,999.99')))
		                ELSEIF mordem = '4'
		                        ASORT(m_curva_b,,, {|z,y| z[20] > y[20]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'999,999.99')))
		                ELSEIF mordem = '5'
		                        ASORT(m_curva_b,,, {|z,y| z[21]+z[2] < y[21]+y[2]})
                                        DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "B" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b,'999,999.99')))
		                ENDIF
                                imprt(mtipo_imp,'N-')
                                imprt(mtipo_imp,'W0')
                                imprt(mtipo_imp,'C')
                                mimp_a := '1'
                                m:=0
                                FOR m = 1 TO LEN(m_curva_b)
                                        msoma_qtd := m_curva_b[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_b[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_b[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_b[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        DEVPOS(PROW()+1,00);DEVOUT(m_curva_b[m,1])
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_curva_b[m,2])

                                        DEVPOS(PROW(),47);DEVOUT(IF(m_curva_b[m,8] <= 0,'*','|'))
                                        DEVPOS(PROW(),PCOL());DEVOUTPICT(m_curva_b[m,8],'999,999')
                                        DEVPOS(PROW(),PCOL());DEVOUT(IF(m_curva_b[m,8] <= 0,'*','|'))

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(m_curva_b[m,7],'99,999.99')
        				ENDIF
	                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_b[m,9],'99,999'))
                                        mqtd1 := mqtd1 + m_curva_b[m,9]
                                        IF ! EMPTY(mdata[2])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_b[m,10],'99,999'))
                                                mqtd2 := mqtd2 + m_curva_b[m,10]
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_b[m,11]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_b[m,11],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_b[m,12]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_b[m,12],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('|')
                                        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(msoma_qtd,'999,999'))
                                        DEVPOS(PROW(),PCOL());DEVOUT('|')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(msoma_qtd/mqtd_mes,'999,999')

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_b[m,20],'99,999.99'))
        	                                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_b[m,8]),'99,999')
                	                        DEVPOS(PROW(),PCOL()+2);DEVOUT(m_curva_b[m,19])
                	               	ENDIF
                                        IF ver_serie() = '141473'
                                                DEVPOS(PROW()+1,00);DEVOUT('Ref.Fab.: '+m_curva_b[m,22])
                                        ENDIF

                                        //IF ver_serie() = '141225' .OR. ver_serie() = '141254'
                                        IF mresumo = 'N'
                                                ult_qtd:={}
                                                cComm  := "SELECT * "
                                                ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL  AND ent_sai = 'E' AND (documento LIKE 'NF%' OR documento LIKE 'PD%')"
                                                ccomm := ccomm + " AND codigo = "+sr_cdbvalue(m_curva_b[m,1])
                                                ccomm := ccomm + " ORDER BY data_s_e "
                                                //ccomm := ccomm + " AND data_s_e = "+sr_cdbvalue(m_curva_b[m,5])
                                                sr_getconnection():exec(ccomm,,.t.,@ult_qtd)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                                IF LEN(ult_qtd) = 0
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('  /  /  ')
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(0,'99,999.99')
                                                ELSE
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(ult_qtd[LEN(ult_qtd),16])
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(ult_qtd[LEN(ult_qtd),19],'99,999.99')
                                                ENDIF
                                        ENDIF

                                        mtot_cust := mtot_cust + m_curva_b[m,20]
                                        mest_cust := mest_cust + (m_curva_b[m,8] * m_curva_b[m,7])
                                        IF mpag = 0 .OR. PROW() >= 59
		                		IF (mop_cab = 'N' .AND. mpag = 0) .OR. mop_cab = 'S'
                                                mpag ++
                                                IF mpag > 1 ;EJECT;ENDIF
                                	        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                                                //cabecalho(mpag,mtit,mtipo,mprg)
                                                imprt(mtipo_imp,'C')
                                                IF ! EMPTY(mcod_forn)
                                                        q_forn := {}
                                                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                        sr_getconnection():exec('COMMIT',,.f.)
                                                        DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                                        DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                                ENDIF
		                                DEVPOS(PROW()+1,47);DEVOUT('       ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
			                       	ENDIF
	        		               	DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
		                 	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
				                        DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
				              	ENDIF
                                		DEVPOS(PROW()+1,00);DEVOUT('Produto')
		                                DEVPOS(PROW(),47);DEVOUT('   Saldo ')
						IF so_qtd = 'N'
                                			DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
		                                ENDIF
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
			                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
        			                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
        	               			ENDIF
		                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
		                                ENDIF
                                        ENDIF
                                NEXT
                        ENDIF
                        IF ! EMPTY(m_curva_c)
                                imprt(mtipo_imp,'N')
                                imprt(mtipo_imp,'W1')
                                imprt(mtipo_imp,'N+')
                		IF mordem = '1'
		                        ASORT(m_curva_c,,, {|z,y| z[2] > y[2]})
                		ELSEIF mordem = '2'
		                        ASORT(m_curva_c,,, {|z,y| z[17] > y[17]})
		                ELSEIF mordem = '3'
		                        ASORT(m_curva_c,,, {|z,y| z[18] > y[18]})
		                ELSEIF mordem = '4'
		                        ASORT(m_curva_c,,, {|z,y| z[20] > y[20]})
		                ELSEIF mordem = '5'
		                        ASORT(m_curva_c,,, {|z,y| z[21]+z[2] < y[21]+y[2]})
		                ENDIF
                                DEVPOS(PROW()+1,0);DEVOUT('1o.CURVA "C" Acima de R$: '+ALLTRIM(TRANSFORM(curva_b - 0.01,'999,999.99')))
                                imprt(mtipo_imp,'N-')
                                imprt(mtipo_imp,'W0')
                                imprt(mtipo_imp,'C')
                                mimp_a := '1'
                                m:=0
                                FOR m = 1 TO LEN(m_curva_c)
                                        msoma_qtd := m_curva_c[m,9]
                                        IF mqtd_mes > 1
                                                msoma_qtd := msoma_qtd + m_curva_c[m,10]
                                        ENDIF
                                        IF mqtd_mes > 2
                                                msoma_qtd := msoma_qtd + m_curva_c[m,11]
                                        ENDIF
                                        IF mqtd_mes > 3
                                                msoma_qtd := msoma_qtd + m_curva_c[m,12]
                                        ENDIF
                                        IF ((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8] < 0 ;
                                           .AND. mcompra_sn = 'S'
                                                LOOP
                                        ENDIF
                                        DEVPOS(PROW()+1,00);DEVOUT(m_curva_c[m,1])
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_curva_c[m,2])

                                        DEVPOS(PROW(),47);DEVOUT(IF(m_curva_c[m,8] <= 0,'*','|'))
                                        DEVPOS(PROW(),PCOL());DEVOUTPICT(m_curva_c[m,8],'999,999')
                                        DEVPOS(PROW(),PCOL());DEVOUT(IF(m_curva_c[m,8] <= 0,'*','|'))

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(m_curva_c[m,7],'99,999.99')
	                               	ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_c[m,9],'99,999'))
                                        mqtd1 := mqtd1 + m_curva_c[m,9]
                                        IF ! EMPTY(mdata[2])
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_c[m,10],'99,999'))
                                                mqtd2 := mqtd2 + m_curva_c[m,10]
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[3])
                                                mqtd3 := mqtd3 + m_curva_c[m,11]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_c[m,11],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        IF ! EMPTY(mdata[4])
                                                mqtd4 := mqtd4 + m_curva_c[m,12]
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_c[m,12],'99,999'))
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                        ENDIF
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('|')
                                        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(msoma_qtd,'999,999'))
                                        DEVPOS(PROW(),PCOL());DEVOUT('|')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(msoma_qtd/mqtd_mes,'999,999')

					IF so_qtd = 'N'
	                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(m_curva_c[m,20],'99,999.99'))
        	                                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(IF(((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8]<=0,0,((msoma_qtd/mqtd_mes) * (mdias/30))-m_curva_c[m,8]),'99,999')
                	                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_curva_c[m,19])
                	               	ENDIF
                                        IF ver_serie() = '141473'
                                                DEVPOS(PROW()+1,00);DEVOUT('Ref.Fab.: '+m_curva_c[m,22])
                                        ENDIF

                                        //IF ver_serie() = '141225' .OR. ver_serie() = '141254'
                                        IF mresumo = 'N'
                                                ult_qtd:={}
                                                cComm  := "SELECT * "
                                                //ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL  AND ent_sai = 'E' AND documento NOT LIKE 'BL%'"
                                                ccomm := ccomm +" FROM sacmov WHERE cancel IS NULL  AND ent_sai = 'E' AND (documento LIKE 'NF%' OR documento LIKE 'PD%')"
                                                ccomm := ccomm + " AND codigo = "+sr_cdbvalue(m_curva_c[m,1])
                                                ccomm := ccomm + " ORDER BY data_s_e "
                                                //ccomm := ccomm + " AND data_s_e = "+sr_cdbvalue(m_curva_c[m,5])
                                                sr_getconnection():exec(ccomm,,.t.,@ult_qtd)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                                IF LEN(ult_qtd) = 0
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('  /  /  ')
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(0,'99,999.99')
                                                ELSE
                                                        DEVPOS(PROW()+1,00);DEVOUT('Ult.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(ult_qtd[LEN(ult_qtd),16])
                                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Qtd.Compra:')
                                                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(ult_qtd[LEN(ult_qtd),19],'99,999.99')
                                                ENDIF
                                        ENDIF
                                        mtot_cust := mtot_cust + m_curva_c[m,20]
                                        mest_cust := mest_cust + (m_curva_c[m,8] * m_curva_c[m,7])
                                        IF mpag = 0 .OR. PROW() >= 59
		                		IF (mop_cab = 'N' .AND. mpag = 0) .OR. mop_cab = 'S'
                                                mpag ++
                                                IF mpag > 1 ;EJECT;ENDIF
                                	        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                                                //cabecalho(mpag,mtit,mtipo,mprg)
                                                imprt(mtipo_imp,'C')
                                                IF ! EMPTY(mcod_forn)
                                                        q_forn := {}
                                                        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                                        sr_getconnection():exec('COMMIT',,.f.)
                                                        DEVPOS(PROW()+1,00);DEVOUT('Fornecedor :'+STRZERO(mcod_forn,4)+'-'+q_forn[1,2]+' Telefones: '+ALLTRIM(q_forn[1,13])+'/'+ALLTRIM(q_forn[1,14]))
                                                        DEVPOS(PROW()+1,00);DEVOUT('Forma Pagamento:'+q_forn[1,21]+' Gerente: '+q_forn[1,22]+' - Vendedor : '+q_forn[1,23])
                                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                                ENDIF
		                                DEVPOS(PROW()+1,47);DEVOUT('       ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
			                       	ENDIF
	        		               	DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT('      ')
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
		                 	        DEVPOS(PROW(),PCOL()+1);DEVOUT('      Media ')
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('   Media ')
				                        DEVPOS(PROW(),PCOL());DEVOUT('Sugestao')
				              	ENDIF
                                		DEVPOS(PROW()+1,00);DEVOUT('Produto')
		                                DEVPOS(PROW(),47);DEVOUT('   Saldo ')
						IF so_qtd = 'N'
                                			DEVPOS(PROW(),PCOL()+1);DEVOUT(' Pr.Custo')
		                                ENDIF
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[1])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[2])
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[3])
                		                DEVPOS(PROW(),PCOL()+1);DEVOUT(' '+mdata[4])
                                		DEVPOS(PROW(),PCOL()+1);DEVOUT(' Tot.Mes ')
		                                DEVPOS(PROW(),PCOL()+1);DEVOUT('  MES:'+STRZERO(mqtd_mes,1))
						IF so_qtd = 'N'
	                        		        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr Custo')
			                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Compra')
        			                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Ds')
        	               			ENDIF
		                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
		                                ENDIF
                                        ENDIF
                                NEXT
                        ENDIF

                ENDIF
                IF mimp_tipo = 4
                        xlsClose( nXls )
                        //MYRUN('EXCEL.EXE '+marq)
                ELSE
                        //IF mresumo = 'S'
                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
			IF so_qtd = 'N'
                                //DEVPOS(PROW()+1,00);DEVOUT('TOTAIS:  Estoque Preco Custo: '+TRANSFORM(mest_cust,'9,999,999.99'))
                                DEVPOS(PROW()+1,67);DEVOUT(TRANSFORM(mqtd1,'99,999'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd2,'99,999'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd3,'99,999'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd4,'99,999'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT(TRANSFORM(mqtd1+mqtd2+mqtd3+mqtd4,'999,999'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT(TRANSFORM((mqtd1+mqtd2+mqtd3+mqtd4)/mqtd_mes,'999,999'))
                                DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(mtot_cust,'9999999.99'))
                        ENDIF
                        DEVPOS(PROW()+2,00);DEVOUT('Total de Item.......:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(LEN(m_imprimir),'999,999'))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Total em Volumes:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,1],'999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Total Custo Mercad..:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,2],'99,999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Total preco de custo:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,3],'99,999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Total preco de venda:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_totais[1,4],'999,999,999.99'))

                        //DEVPOS(PROW()+1,00);DEVOUT('Quantidade de Itens: '+TRANSFORM(LEN(m_imprimir),'99,999'))
                        DEVPOS(PROW()+2,00);DEVOUT(TIME())
                        imprt(mtipo_imp,'N')
                        EJECT
                        SETPRC(00,00)
                        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
                        conf_impressao(marq)
                ENDIF
        ENDIF
ENDDO
wvw_lclosewindow()
RETURN NIL
*************************** F I M ************************
FUNCTION forn_526()
*************************
LOCAL MPRG:='SAC526'
mensagem('Espere o Final da Impressao OK - [ESC]Abandonar')
marq := 'MOV_MES.REL'
IF ! imp_arq('MOV_MES.REL','R')
        RETURN NIL
ENDIF
i := 0
FOR i = 1 TO 4
        IF ! EMPTY(mdata[i]);mqtd_mes ++;ENDIF
NEXT
mpag := 0
****************************
SELE('forn');ORDSETFOCUS(2)
GO TOP
*****************************
WHILE ! EOF()
        ************
        SELE('merc');ORDSETFOCUS(4)
        GO TOP
        ************
        IF ! merc->(DBSEEK(forn->cod_forn))
                *****************
                SELE('forn');ORDSETFOCUS(2)
                *****************
                SKIP;LOOP
        ENDIF
        mtit = 'Listagem de Produto p/Meses ** FORNECEDOR **'
        mtipo := 'Meses: '+mdata[1]+', '+mdata[2]+', '+mdata[3]+', '+mdata[4]
        IF mpag > 0
                DEVPOS(PROW()+1,00)
                imprt(mtipo_imp,'N')
                imprt(mtipo_imp,'N+')
                DEVPOS(PROW()+1,00);DEVOUT('FORNECEDOR: '+forn->cod_forn+' - '+forn->razao)
                imprt(mtipo_imp,'N-')
                imprt(mtipo_imp,'C')
        ENDIF
        WHILE ! EOF() .AND. merc->cod_fab = forn->cod_forn
                IF (! EMPTY(mgrupo) .AND. STRZERO(mgrupo,3) <> SUBSTR(merc->gru_sub,1,3))
                        SKIP;LOOP
                ENDIF
                IF mpag = 0 .OR. PROW() >= 59
                        mpag ++
                        IF mpag > 1 ;EJECT;ENDIF
                        cabecalho(mpag,mtit,mtipo,mprg,,STRZERO(mgrupo,3),STRZERO(mgrupo,3)+STRZERO(msubgrupo,2),STRZERO(mcod_forn,4),mcod_cli,STRZERO(mcod_ven,3),STRZERO(mcod_ope,3))
                        //cabecalho(mpag,mtit,mtipo,mprg)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT('Meses:')
                        DEVPOS(PROW(),54);DEVOUT(mdata[1])
                        DEVPOS(PROW(),72);DEVOUT(mdata[2])
                        DEVPOS(PROW(),90);DEVOUT(mdata[3])
                        DEVPOS(PROW(),108);DEVOUT(mdata[4])
                        DEVPOS(PROW(),127);DEVOUT('Total')
                        DEVPOS(PROW()+1,00);DEVOUT('Produto')
                        DEVPOS(PROW(),50);DEVOUT('Qtd.')
                        DEVPOS(PROW(),59);DEVOUT('Valor')
                        DEVPOS(PROW(),68);DEVOUT('Qtd.')
                        DEVPOS(PROW(),77);DEVOUT('Valor')
                        DEVPOS(PROW(),86);DEVOUT('Qtd.')
                        DEVPOS(PROW(),95);DEVOUT('Valor')
                        DEVPOS(PROW(),104);DEVOUT('Qtd.')
                        DEVPOS(PROW(),113);DEVOUT('Valor')
                        DEVPOS(PROW(),123);DEVOUT('Qtd.')
                        DEVPOS(PROW(),132);DEVOUT('Vlr.')
                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        imprt(mtipo_imp,'N+')
                        DEVPOS(PROW()+1,00);DEVOUT('FORNECEDOR: '+forn->cod_forn+' - '+forn->razao)
                        imprt(mtipo_imp,'N-')
                        imprt(mtipo_imp,'C')
                ENDIF
                ***************************
                SELE('mov');ORDSETFOCUS(9)
                ***************************
                mcodigo := merc->cod_merc
                i := 0
                FOR i = 1 TO 4
                        IF ! mov->(DBSEEK(SUBSTR(mdata[i],4,2)+SUBSTR(mdata[i],1,2)+mcodigo))
                                LOOP
                        ELSE
                                WHILE mcodigo = mov->codigo .AND. mdata[i] = SUBSTR(DTOC(mov->data_s_e),4) .AND. ! EOF()
                                        IF (mov->cancel = 'C' .OR. mov->tipo = '01');
                                           .OR. mov->ent_sai = 'E' .OR. SUBSTR(mov->documento,1,2) = 'BL';
                                           .OR. (! EMPTY(mgrupo) .AND. STRZERO(mgrupo,3) <> SUBSTR(mov->gru_sub,1,3));
                                           .OR. (! EMPTY(mcod_cli) .AND. mov->cod_cli <> mcod_cli);
                                           .OR. (! EMPTY(mcod_ven) .AND. STRZERO(mcod_ven,3) <> mov->cod_vend);
                                           .OR. (! EMPTY(mexc_forn) .AND. mov->cod_fab = STRZERO(mexc_forn,4));
                                           .OR. (! EMPTY(mexc_cli) .AND. mov->cod_cli = STRZERO(mexc_cli,5));
                                           .OR. (! EMPTY(mexc_vend) .AND. STRZERO(mexc_vend,3) = mov->cod_vend);
                                           .OR. (! EMPTY(mcod_ope) .AND. STRZERO(mcod_ope,3) <> mov->cod_oper);
                                           .OR. mov->descont = 'S'
                                                SKIP;LOOP
                                        ENDIF
                                        SETPOS(18,21);DISPOUT(merc->cod_merc+'-'+merc->merc)
                                        mqtd[i]:=mqtd[i] + mov->quantd
                                        IF mpreco = 'V'
                                                mvlr[i]:=mvlr[i] + (mov->vl_fatura * mov->quantd)
                                        ELSEIF mpreco = 'C'
                                                mvlr[i]:=mvlr[i] + (mov->pr_unit * mov->quantd)
                                        ENDIF
                                        SETPOS(18,2);DISPOUT('Quantd.Unit: '+TRANSFORM(mov->quantd,'99999.99')+' Vlr.Unit: '+TRANSFORM(mov->vl_fatura,'999999.99')+' Quantd.Acum.: '+TRANSFORM(mqtd[i],'99999.99'))
                                        SKIP
                                ENDDO
                        ENDIF
                NEXT
                IF mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4] > 0 .OR. mimp_mov = 'S'
                        IF mtip_cod = 'C'
                                DEVPOS(PROW()+1,00);DEVOUT(merc->cod_merc)
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(merc->merc)
                        ELSE
                                DEVPOS(PROW()+1,00);DEVOUT(merc->cod_barr)
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(LEFT(merc->merc,31))
                        ENDIF
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd[1],'9999.99'))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr[1]/mqtd[1],'999999.99'))
                        IF ! EMPTY(mdata[2])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd[2],'9999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr[2]/mqtd[2],'999999.99'))
                        ELSE
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
                        ENDIF
                        IF ! EMPTY(mdata[3])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd[3],'9999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr[3]/mqtd[3],'999999.99'))
                        ELSE
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
                        ENDIF
                        IF ! EMPTY(mdata[4])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd[4],'9999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr[4]/mqtd[4],'999999.99'))
                        ELSE
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('       ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('         ')
                        ENDIF
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4],'99999.99'))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM((mvlr[1]+mvlr[2]+mvlr[3]+mvlr[4])/(mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4]),'999999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Saldo:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(merc->saldo_mer,'99,999.99')
                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Est.Min.:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(merc->est_min,'99,999.99')
                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Ult.Compra:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(merc->dat_ult_e)
                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Ult.Custo:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(merc->pr_unit,'99,999.99')
                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Media p/Mes:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT((mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4])/mqtd_mes,'99,999')
                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Sugestao Compra:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(IF((((mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4])/mqtd_mes) * (mdias/30))-merc->saldo_mer<=0,0,(((mqtd[1]+mqtd[2]+mqtd[3]+mqtd[4])/mqtd_mes) * (mdias/30))-merc->saldo_mer),'99,999')
                ENDIF
                x := 0
                FOR x = 1 TO 4
                        mqtd[x] := mvlr[x] := 0
                NEXT
                ************
                SELE('merc');ORDSETFOCUS(4)
                SKIP
                ************
        ENDDO
        ******************************
        SELE('forn');ORDSETFOCUS(2)
        ******************************
        SKIP
ENDDO
DEVPOS(PROW()+2,00);DEVOUT(TIME())
imprt(mtipo_imp,'N')
EJECT
SETPRC(00,00)
SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
conf_impressao(marq)
RETURN NIL
*************************** F I M ************************
