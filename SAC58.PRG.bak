*******************
* LISTAGEM P/BALANCO
*******************
MEMVAR getlist,mcaminho,nivel_acess

FUNCTION sac58
**************
LOCAL MPRG:='SAC58',;
      tela,lci,cci,lba,cba,mgrupo1,opcao,;
      i,mtecla,msele,morde,mtipo_cons

PRIVATE mtraco,mtot_item,telaprint,mtit,mtipo,mpag,mav,mquantd,msaldo_ped,;
        mtipo_imp,mimp_tipo:=0,marq:=SPACE(35),msub_grupo,mdesc_sub,mfalta,;
        mcod_forn:=0,mcod_espe:=0,m_merc:={},cons_soma:={}

IF ! ver_nivel(mprg,'RELATORIO PARA BALANCO','1456',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
mtraco := REPLI('=',80)

lci := cci := 0
lba := 12
cba := 77

IF ! AbriArq('sacgrupo','grup');RETURN NIL;ENDIF
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF
IF ! AbriArq('sacespe','espe');RETURN NIL;ENDIF
IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
*-------------------------------------------------------------------------
op_tela(lci,cci,lba+2,cba,' Listagem Balanco ')
WHILE .T.
        limpa(00,00,24,80)
********* VARIAVEIS DE IMPRESSAO *******************
        mtipo_imp := m_indiv[1,18]
****************************************************
        mquantd = 1
        mgrupo1 := SPACE(5)
        msub_grupo = SPACE(2)
        mtot_item := msaldo_ped := 0
        mtipo_cons := '2'
        mfalta     := 'N'
        mensagem('Preencha os Campos ou em Branco p/Imprimir todos - <ESC>p/Abandonar')
        DEVPOS(lci+1,cci+2);DEVOUT('Cod.Grupo......:')
        DEVPOS(lci+2,cci+2);DEVOUT('Cod.Sub-Grupo..:')
        DEVPOS(lci+3,cci+2);DEVOUT('Cod.Fornecedor.:')
        DEVPOS(lci+4,cci+2);DEVOUT('Tipo...........:')
        DEVPOS(lci+5,cci+2);DEVOUT('Cod.Especie....:')
        DEVPOS(lci+6,cci+2);DEVOUT('So Produtos que estao lista de falta [s/N]:')
        @ lci+7,cci TO lci+7,cba
        DEVPOS(lci+8,cci+1);DEVOUT(' Com A.V ')
        DEVPOS(lci+8,cci+14);DEVOUT(' Sem A.V ')
        DEVPOS(lci+8,cci+28);DEVOUT(' Sem Saldos ')
        DEVPOS(lci+9,cci+1);DEVOUT(' Sem A.V./Sem pendentes')
        DEVPOS(lci+9,cci+30);DEVOUT(' Com A.V./Sem pendentes')
        @ lci+10,cci+1 TO lci+10,cba-1
        DEVPOS(lci+11,cci+2);DEVOUT('Quantd.Copias..:')

        @ lci+1,cci+19 GET mgrupo1 PICT '999' VALID v_gru_cod(mgrupo1,2,lci+1,cci+23)
        @ lci+2,cci+19 GET msub_grupo PICT '99' WHEN ! EMPTY(mgrupo1) VALID IF(LEN(ALLTRIM(msub_grupo)) < 2,.F.,.T.) .AND. ver_sgru(VAL(mgrupo1),VAL(msub_grupo),lci+2,cci+23)
        @ lci+3,cci+19 GET mcod_forn PICT '9999' VALID v_fornece(mcod_forn,lci+3,cci+24)
        @ lci+4,cci+19 GET mtipo_cons PICT '@!' VALID mtipo_cons $ '1,2' .AND. lim_get() WHEN men_get(1,1,'<1>Com - <2>Sem')
        @ lci+5,cci+19 GET mcod_espe PICT '9999' VALID ver_espe(mcod_espe,lci+5,cci+24,,0)
        @ lci+6,cci+45 GET mfalta PICT '@!' VALID mfalta $ 'S,N'
        READ
        IF LASTKEY() = 27
                CLOSE ALL
                EXIT
        ENDIF
        IF ! EMPTY(msub_grupo)
                mdesc_sub := grup->merc
        ENDIF

        mav = 1
        IF mfalta = 'N'
                setcor(10)
                @ lci+8,cci+1 PROMPT ' Com A.V '
                @ lci+8,cci+14 PROMPT ' Sem A.V '
                @ lci+8,cci+28 PROMPT ' Sem Saldos '
                @ lci+9,cci+1 PROMPT ' Sem A.V./Sem pendentes '
                @ lci+9,cci+30 PROMPT ' Com A.V./Sem pendentes '
                SET INTEN ON
                MENU TO mav
                setcor(1)
                IF LASTKEY() = 27
                        LOOP
                ENDIF
        ENDIF
        setcor(1)
        @ lci+11,cci+19 GET mquantd PICT '99999'
        READ
        IF LASTKEY() = 27
                LOOP
        ENDIF

        //IF EMPTY(mgrupo1)
                mtecla := ' '
                op_tela(10,10,11,60,'ESCOLHA A ORDEM QUE DESEJA IMPRIMIR O RELATORIO')
                DEVPOS(00,00);DEVOUT('[1]Alfabetica - [2]Codigo Produto - [3]Ref.Aux.:')
                @ 00,COL()+1 GET mtecla PICT '@!' VALID mtecla $ '1,2,3'
                READ
                wvw_lclosewindow()
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                m_merc:={}
                cComm  := "SELECT "
                ccomm := ccomm + "cod_merc  ,merc    ,especie  ,disp     ,saldo_mer,"
                ccomm := ccomm + "data_falta,cod_fab ,data_cad ,promocao ,empresa  ,"
                ccomm := ccomm + "cod_barr  ,unidade ,pr_venda ,pr_venda1,varejo   ,"
                ccomm := ccomm + "sit_trib  ,ind_icms,qtd_falta,gru_sub  ,ref      ,"
                ccomm := ccomm + "saldo_fis ,saldo_av,cust_real"
                ccomm := ccomm + " FROM sacmerc "
                ccomm := ccomm + " WHERE disp = 'S' AND cod_merc IS NOT NULL"
		cComm  := ccomm + " AND (descont = 'N' OR descont IS NULL OR descont = ' ')"
                IF ! EMPTY(mcod_forn)
                        ccomm := ccomm + "  AND cod_fab ="+sr_cdbvalue(STRZERO(mcod_forn,4))
                ENDIF
                IF mfalta = 'S'
                        ccomm := ccomm + "  AND data_falta IS NOT NULL"
                ENDIF
                IF ! EMPTY(mcod_espe)
                        ccomm := ccomm + "  AND especie ="+sr_cdbvalue(STRZERO(mcod_espe,4))
                ENDIF
		cComm  := ccomm + " AND (descont = 'N' OR descont IS NULL OR descont = ' ')"
        	IF ! EMPTY(msub_grupo)
	                //cComm  := ccomm + " AND gru_sub = "+sr_cdbvalue(STRZERO(mgrupo1,3)+STRZERO(msub_grupo,2))
	                cComm  := ccomm + " AND gru_sub = "+sr_cdbvalue(ALLTRIM(mgrupo1)+ALLTRIM(msub_grupo))
        	ELSEIF ! EMPTY(mgrupo1)
        	        //cComm  := ccomm + " AND gru_sub LIKE "+sr_cdbvalue(STRZERO(mgrupo1,3)+'%')
        	        cComm  := ccomm + " AND gru_sub LIKE "+sr_cdbvalue(ALLTRIM(mgrupo1)+'%')
	        ENDIF
                IF mtecla = '1'
                        ccomm := ccomm + " ORDER BY merc"
                ELSEIF mtecla = '2'
                        ccomm := ccomm + " ORDER BY cod_merc"
                ELSEIF mtecla = '3'
                        ccomm := ccomm + " ORDER BY ref,merc"
                ENDIF
                sr_getconnection():exec( cComm,,.t.,@m_merc)
                sr_getconnection():exec('COMMIT',,.f.)
                IF ! imp_arq('TAB_CUSTO.REL','R')
                        LOOP
                ENDIF
                f:=0
                FOR f = 1 TO mquantd
                        msaldo_ped := mpag := 0
                        IF mfalta = 'S'
                                mtit := 'Listagem de Falta Produto'
                        ELSE
                                mtit := 'Listagem para Balanco'
                        ENDIF
                        IF ! EMPTY(mcod_forn)
                                q_forn := {}
                                sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@q_forn)
                                sr_getconnection():exec('COMMIT',,.f.)
                                mtit := mtit + ' do FORNECEDOR: '+q_forn[1,1]+'-'+q_forn[1,2]
                        ENDIF
                        IF mtecla = '1'
                                mtipo := 'por Ordem Alfabetica - Tipo: '+mtipo_cons
                        ELSEIF mtecla = '2'
                                mtipo := 'por Ordem de Codigo - Tipo: '+mtipo_cons
                        ELSEIF mtecla = '3'
                                mtipo := 'por Ordem de Ref.Auxiliar - Tipo: '+mtipo_cons
                        ENDIF
                        i:=0
                        FOR i = 1 TO LEN(m_merc)
                                prog_imp(i,m_merc[i,1]+'-'+m_merc[i,2])
                                IF mpag = 0 .OR. PROW() >= 59
                                        mpag ++
                                        IF mpag > 1
                                                EJECT
                                        ENDIF
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        IF mfalta = 'N'
                                                DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                                DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                                DEVPOS(PROW()+1,79);DEVOUT('Pendente')
                                                DEVPOS(PROW(),79);DEVOUT('P')
                                                DEVPOS(PROW(),88);DEVOUT('D')
                                                DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                                DEVPOS(PROW(),99);DEVOUT('H')
                                                DEVPOS(PROW(),99);DEVOUT('Haver')
                                                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                                DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        ELSE
                                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Prc. Custo  Prc. Venda')
                                        ENDIF
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
				        IF ! EMPTY(mgrupo1)
						prt_gru(VAL(mgrupo1))
				        ENDIF
					IF ! EMPTY(msub_grupo)
	                			prt_sgru(VAL(mgrupo1),VAL(msub_grupo))
		               		ENDIF
                                ENDIF
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT(m_merc[i,1])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,11])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,2])
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,20])
                                IF mfalta = 'N'
                                        IF mav < 4
                                                cons_soma := {}
                                                sr_getconnection():exec("SELECT SUM(pquantd) FROM sacped_s WHERE sr_deleted = ' ' AND pcod_merc = "+sr_cdbvalue(m_merc[i,1])+" AND ppag <> 'C' AND pentreg IS NULL",,.t.,@cons_soma)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                                msaldo_ped := 0
                                                IF LEN(cons_soma) > 0
                                                        msaldo_ped := cons_soma[1,1]
                                                ENDIF

                                        ENDIF
                                        IF mav = 3
                                                DEVPOS(PROW(),116);DEVOUT('....................')
                                        ELSEIF mav = 4
                                                IF mtipo_cons = '2'
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,5],'99999.99')
                                                ELSE
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,21],'99999.99')
                                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,21],'99999.99')
                                                ENDIF
                                                DEVPOS(PROW(),116);DEVOUT('....................')
                                        ELSEIF mav = 5
                                                IF mtipo_cons = '2'
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                                ELSE
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,21],'99999.99')
                                                ENDIF
                                                DEVPOS(PROW(),97);DEVOUTPICT(m_merc[i,22],'99999.99')
                                                IF mtipo_cons = '2'
                                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,5],'99999.99')
                                                ELSE
                                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,21],'99999.99')
                                                ENDIF
                                                DEVPOS(PROW(),116);DEVOUT('....................')
                                        ELSE
                                                DEVPOS(PROW(),80);DEVOUTPICT(msaldo_ped,'99999.99')
                                                IF mtipo_cons = '2'
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                                ELSE
                                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,21],'99999.99')
                                                ENDIF
                                                IF mav = 1
                                                        DEVPOS(PROW(),97);DEVOUTPICT(m_merc[i,22],'99999.99')
                                                        IF mtipo_cons = '2'
                                                                DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,5] + msaldo_ped,'99999.99')
                                                        ELSE
                                                                DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,21] + msaldo_ped,'99999.99')
                                                        ENDIF
                                                ELSE
                                                        IF mtipo_cons = '2'
                                                                DEVPOS(PROW(),106);DEVOUTPICT(msaldo_ped + m_merc[i,5],'99999.99')
                                                        ELSE
                                                                DEVPOS(PROW(),106);DEVOUTPICT(msaldo_ped + m_merc[i,21],'99999.99')
                                                        ENDIF
                                                ENDIF
                                                DEVPOS(PROW(),116);DEVOUT('....................')
                                        ENDIF
                                        msaldo_ped := 0
                                ELSE
                                        DEVPOS(PROW(),PCOL()+2);DEVOUT(TRANSFORM(m_merc[i,13],'999,999.99'))
                                        DEVPOS(PROW(),PCOL()+2);DEVOUT(TRANSFORM(m_merc[i,23],'999,999.99'))
                                ENDIF
                                mtot_item ++
                        NEXT
                        IF PROW() >= 57
                                EJECT
                                mpag ++
                                cabecalho(mpag,mtit,mtipo)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                IF mfalta = 'N'
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,79);DEVOUT('Pendente')
                                        DEVPOS(PROW(),79);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                ELSE
                                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Prc. Custo  Prc. Venda')
                                ENDIF
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
				IF ! EMPTY(mgrupo1)
					prt_gru(VAL(mgrupo1))
				ENDIF
				IF ! EMPTY(msub_grupo)
	                		prt_sgru(VAL(mgrupo1),VAL(msub_grupo))
		               	ENDIF
                        ENDIF
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+3,00);DEVOUT('Total de Item:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(LTRIM(TRANSFORM(mtot_item,'999,999.99')))
                        DEVPOS(PROW()+2,00);DEVOUT(TIME())
                        EJECT
*                       SETPRC(00,00)
*                       EXIT
                NEXT
                SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
                conf_impressao('TAB_CUSTO.REL')
                /*
                IF mimp_tipo = 2
                        lertexto('TAB_CUSTO.REL')
                ELSEIF mtipo_imp = 'D'
                        
                ELSE
                        MYRUN('DOSPRINTER /RAW /DEL '+ALLTRIM(m_indiv[1,5])+'HTI.REL')
                ENDIF
                */
                LOOP
        //ENDIF
/*
        opcao := op_simnao('S','Confirm Impressao [S/n]:')
        IF opcao = 'N'
                LOOP
        ENDIF
        IF ! imp_arq('TAB_CUSTO.REL','R')
                LOOP
        ENDIF
	IF ! EMPTY(mgrupo1)     //.AND. ! EMPTY(msub_grupo)
                *****************
                SELE('merc');ORDSETFOCUS(5)
                GO TOP
                *****************
                mensagem('Aguarde preparando ambiente para Tabela de Preco...')
                ASIZE(m_merc,0)
                WHILE ! EOF()
                             //           1                   2              3              4               5
                             //           6                   7              8              9              10
                             //          11                  12             13             14              15
                             //          16                  17             18             19              20
                             //          21                  22             23
                        AADD(m_merc,{merc->cod_merc  ,merc->merc    ,merc->especie  ,merc->disp     ,merc->saldo_mer,;
                                     merc->data_falta,merc->cod_fab ,merc->data_cad ,merc->promocao ,merc->empresa  ,;
                                     merc->cod_barr  ,merc->unidade ,merc->pr_venda ,merc->pr_venda1,merc->varejo   ,;
                                     merc->sit_trib  ,merc->ind_icms,merc->qtd_falta,merc->gru_sub  ,merc->ref      ,;
                                     merc->saldo_fis ,merc->saldo_av,merc->cust_real})
                        SKIP
                ENDDO
                imp_sg(VAL(mgrupo1),VAL(msub_grupo),mdesc_sub)
        ELSEIF ! EMPTY(mgrupo1) .AND. EMPTY(msub_grupo)
                imp_g(mgrupo1,mgrupo2)
        ENDIF
*/
        conf_impressao('TAB_CUSTO.REL')
        /*
        IF mimp_tipo = 2
                lertexto('TAB_CUSTO.REL')
        ELSEIF mtipo_imp = 'D'
                
        ELSE
                MYRUN('DOSPRINTER /RAW /DEL '+ALLTRIM(m_indiv[1,5])+'HTI.REL')
        ENDIF
        */
        LOOP
ENDDO
wvw_lclosewindow()
RETURN NIL
***************************** F I M **************************************
/*
********************
* IMPRIMI OS GRUPO
********************

FUNCTION imp_g(vgrupo1,vgrupo2)
**********************************

LOCAL mgru,msgru,mpoint,msele,morde,msaldo_ped,i
MEMVAR mquantd,mtipo_imp,mtraco,mav,mtot_item,mpag,mtit,mtipo

WHILE .T.
        f:=0
        FOR f = 1 TO mquantd
                i:=1
                msaldo_ped := 0
                mgru := SUBSTR(m_merc[i,19],1,3)
                msgru := SUBSTR(m_merc[i,19],4,2)
                mpag = 1
                mtit := 'Listagem p/Balanco'
                mtipo := 'Grupo: '+RTRIM(vgrupo1)+' a '+RTRIM(vgrupo2)
                cabecalho(mpag,mtit,mtipo)
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                DEVPOS(PROW(),80);DEVOUT('P')
                DEVPOS(PROW(),88);DEVOUT('D')
                DEVPOS(PROW(),88);DEVOUT('Dispon.')
                DEVPOS(PROW(),99);DEVOUT('H')
                DEVPOS(PROW(),99);DEVOUT('Haver')
                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                DEVPOS(PROW(),121);DEVOUT('Fisico')
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                mpoint := RECNO()
                prt_gru(VAL(SUBSTR(m_merc[i,19],1,3)))
                IF (! EMPTY(mcod_forn) .AND. m_merc[i,7] <> STRZERO(mcod_forn,4));
                   .OR. (SUBSTR(m_merc[i,19],4,2) = SPACE(2));
                   .OR. (m_merc[i,4] = 'N');
                   .OR. (mfalta = 'S' .AND. EMPTY(m_merc[i,6]));
                   .OR. (! EMPTY(mcod_espe) .AND. STRZERO(mcod_espe,4) <> m_merc[i,3])
                        i++
                ENDIF
                msgru := SUBSTR(m_merc[i,19],4,2)
                prt_sgru(VAL(SUBSTR(m_merc[i,19],1,3)),VAL(SUBSTR(m_merc[i,19],4,2)))
                FOR i = 1 TO LEN(m_merc)
                        IF VAL(SUBSTR(m_merc[i,19],1,3)) > VAL(vgrupo2)
                                EXIT
                        ENDIF
                        IF SUBSTR(m_merc[i,19],1,3) <> mgru
                                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                                prt_gru(VAL(SUBSTR(m_merc[i,19],1,3)))
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                                mgru := SUBSTR(m_merc[i,19],1,3)
                                IF (! EMPTY(mcod_forn) .AND. m_merc[i,7] <> STRZERO(mcod_forn,4));
                                   .OR. (SUBSTR(m_merc[i,19],4,2) = SPACE(2));
                                   .OR. (m_merc[i,4] = 'N');
                                   .OR. (mfalta = 'S' .AND. EMPTY(m_merc[i,6]));
                                   .OR. (! EMPTY(mcod_espe) .AND. STRZERO(mcod_espe,4) <> m_merc[i,3])
                                        i++
                                ENDIF
                                prt_sgru(VAL(SUBSTR(m_merc[i,19],1,3)),VAL(SUBSTR(m_merc[i,19],4,2)))
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                                msgru := SUBSTR(m_merc[i,19],4,2)
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                        ENDIF
                        IF msgru <> SUBSTR(m_merc[i,19],4,2)
                                prt_sgru(VAL(SUBSTR(m_merc[i,19],1,3)),VAL(SUBSTR(m_merc[i,19],4,2)))
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                                msgru := SUBSTR(m_merc[i,19],4,2)
                                DEVPOS(PROW()+1,00);DEVOUT(' ')
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                        ENDIF
                        IF (! EMPTY(mcod_forn) .AND. m_merc[i,7] <> STRZERO(mcod_forn,4));
                           .OR. (m_merc[i,1] = SPACE(5));
                           .OR. (m_merc[i,4] = 'N');
                           .OR. (mfalta = 'S' .AND. EMPTY(m_merc[i,6]));
                           .OR. (! EMPTY(mcod_espe) .AND. STRZERO(mcod_espe,4) <> m_merc[i,3])
                                i++;LOOP
                        ENDIF
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(m_merc[i,1])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,11])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,2])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,20])
                        msele:=SELE()
                        morde := INDEXORD()
                        IF mav < 4
                                **************
                                SELE('ped_s');ORDSETFOCUS(4)
                                **************
                                IF ped_s->(DBSEEK(m_merc[i,1])) .AND. ped_s->ppag <> 'C'
                                        WHILE m_merc[i,1] = ped_s->pcod_merc
                                                IF ped_s->pentreg = '*' .OR. ped_s->ppag = 'C'
                                                        SKIP;LOOP
                                                ENDIF
                                                msaldo_ped := msaldo_ped + ped_s->pquantd
                                                SKIP
                                        ENDDO
                                ENDIF
                        ENDIF
                        **************
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        **************
                        IF mav = 3
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ELSEIF mav = 5
                                IF mtipo_cons = '2'
                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                ELSE
                                        DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,21],'99999.99')
                                ENDIF
                                DEVPOS(PROW(),97);DEVOUTPICT(m_merc[i,22],'99999.99')
                                IF mtipo_cons = '2'
                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,5],'99999.99')
                                ELSE
                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,21],'99999.99')
                                ENDIF
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ELSE
                                DEVPOS(PROW(),80);DEVOUTPICT(msaldo_ped,'99999.99')
                                DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                IF mav = 1
                                        DEVPOS(PROW(),97);DEVOUTPICT(m_merc[i,22],'99999.99')
                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,5] + msaldo_ped,'99999.99')
                                ELSE
                                        DEVPOS(PROW(),106);DEVOUTPICT(msaldo_ped + m_merc[i,5],'99999.99')
                                ENDIF
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ENDIF
                        msaldo_ped := 0
                        IF PROW() >= 58
                                EJECT
                                mpag ++
                                cabecalho(mpag,mtit,mtipo)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                DEVPOS(PROW(),80);DEVOUT('P')
                                DEVPOS(PROW(),88);DEVOUT('D')
                                DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                DEVPOS(PROW(),99);DEVOUT('H')
                                DEVPOS(PROW(),99);DEVOUT('Haver')
                                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                DEVPOS(PROW(),121);DEVOUT('Fisico')
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        ENDIF
                        IF m_merc[i,9] <> 0
                                DEVPOS(PROW()+1,07);DEVOUT('Mercadoria em Promocao')
                                DEVPOS(PROW(),07);DEVOUT('Mercadoria em Promocao')
                                DEVPOS(PROW(),70);DEVOUTPICT(m_merc[i,13] - (m_merc[i,13] * (m_merc[i,9] / 100)),'9,999,999.99')
                                IF PROW() >= 58
                                        EJECT
                                        mpag ++
                                        cabecalho(mpag,mtit,mtipo)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                        DEVPOS(PROW(),80);DEVOUT('P')
                                        DEVPOS(PROW(),88);DEVOUT('D')
                                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                        DEVPOS(PROW(),99);DEVOUT('H')
                                        DEVPOS(PROW(),99);DEVOUT('Haver')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                                        imprt(mtipo_imp,'N')
                                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                ENDIF
                        ENDIF
                        imprt(mtipo_imp,'N')
                        mtot_item ++
                        SKIP
                        IF PROW() >= 58
                                EJECT
                                mpag ++
                                cabecalho(mpag,mtit,mtipo)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                                DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                                DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                                DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                                DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                                DEVPOS(PROW(),80);DEVOUT('P')
                                DEVPOS(PROW(),88);DEVOUT('D')
                                DEVPOS(PROW(),88);DEVOUT('Dispon.')
                                DEVPOS(PROW(),99);DEVOUT('H')
                                DEVPOS(PROW(),99);DEVOUT('Haver')
                                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                DEVPOS(PROW(),107);DEVOUT('P+D+H')
                                DEVPOS(PROW(),121);DEVOUT('Fisico')
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        ENDIF
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
                IF PROW() >= 53
                        EJECT
                        mpag ++
                        cabecalho(mpag,mtit,mtipo)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                        DEVPOS(PROW(),80);DEVOUT('P')
                        DEVPOS(PROW(),88);DEVOUT('D')
                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                        DEVPOS(PROW(),99);DEVOUT('H')
                        DEVPOS(PROW(),99);DEVOUT('Haver')
                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                ENDIF
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT('Total de Item:')
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mtot_item,'9,999,999.99')
                DEVPOS(PROW()+2,00);DEVOUT(TIME())
                EJECT
                SETPRC(00,00)
        NEXT
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        RETURN NIL
ENDDO
RETURN NIL
************************************** F I M ***************************
********************
* IMPRIMI OS SUB-GRUPO
********************

FUNCTION imp_sg(vgrupo,vsgru,vdesc)
**********************************

LOCAL mgru,msgru,mpoint,i:=0,msele,morde
MEMVAR mquantd,mtipo_imp,mtot_item,mpag,mtit,mtipo,mtraco,mav,msaldo_ped

WHILE .T.
        FOR i = 1 TO mquantd
                mgru := STRZERO(vgrupo,3)
                msgru := STRZERO(vsgru,2)
                mpag = 1
                mtot_item := 0
                mtipo := 'Grupo: '+RTRIM(STRZERO(vgrupo,3))+'.'+RTRIM(STRZERO(vsgru,2))
                cabecalho(mpag,mtit,mtipo)
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                DEVPOS(PROW(),92);DEVOUT('F')
                DEVPOS(PROW(),92);DEVOUT('Fisico')
                DEVPOS(PROW(),101);DEVOUT('A')
                DEVPOS(PROW(),101);DEVOUT('A.V.')
                DEVPOS(PROW(),107);DEVOUT('F + A')
                DEVPOS(PROW(),107);DEVOUT('F + A')
                DEVPOS(PROW(),116);DEVOUT('Fiscal')
                DEVPOS(PROW(),129);DEVOUT('Fisico')
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
*               mpoint := RECNO()
*               prt_gru(VAL(SUBSTR(STRZERO(vgrupo,3),1,3)))
*               prt_sgru(VAL(SUBSTR(STRZERO(vgrupo,3),1,3)),VAL(STRZERO(vsgru,2)))
*               GO mpoint
*               WHILE STRZERO(vgrupo,3)+STRZERO(vsgru,2) = m_merc[i,19] .AND. ! EOF()
                i:=0
                FOR i = 1 TO LEN(m_merc)
                        IF (! EMPTY(mcod_forn) .AND. m_merc[i,7] <> STRZERO(mcod_forn,4));
                           .OR. (STRZERO(vgrupo,3) <> SUBSTR(m_merc[i,19],1,3));
                           .OR. (m_merc[i,4] = 'N');
                           .OR. (mfalta = 'S' .AND. EMPTY(m_merc[i,6]));
                           .OR. (! EMPTY(mcod_espe) .AND. STRZERO(mcod_espe,4) <> m_merc[i,3])
                                SKIP;LOOP
                        ENDIF
                        IF (! EMPTY(vsgru) .AND. SUBSTR(m_merc[i,19],4,2) <> STRZERO(vsgru,2));
                           .OR. (m_merc[i,1] = SPACE(5))
                                SKIP;LOOP
                        ENDIF
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(m_merc[i,1])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,11])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,2])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(m_merc[i,20])
                        msele:=SELE()
                        morde := INDEXORD()
                        IF mav <> 4
                                **************
                                SELE('ped_s');ORDSETFOCUS(4)
                                **************
                                IF ped_s->(DBSEEK(m_merc[i,1])) .AND. ped_s->ppag <> 'C'
                                        WHILE m_merc[i,1] = ped_s->pcod_merc
                                                IF ped_s->pentreg = '*' .OR. ped_s->ppag = 'C'
                                                        SKIP;LOOP
                                                ENDIF
                                                msaldo_ped := msaldo_ped + ped_s->pquantd
                                                SKIP
                                        ENDDO
                                ENDIF
                                **************
                                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                                **************
                        ENDIF
                        IF mav = 3
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ELSEIF mav = 4
                                DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,5],'99999.99')
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ELSE
                                DEVPOS(PROW(),80);DEVOUTPICT(msaldo_ped,'99999.99')
                                DEVPOS(PROW(),88);DEVOUTPICT(m_merc[i,5],'99999.99')
                                IF mav = 1
                                        DEVPOS(PROW(),97);DEVOUTPICT(m_merc[i,22],'99999.99')
                                        DEVPOS(PROW(),106);DEVOUTPICT(m_merc[i,22] + m_merc[i,5] + msaldo_ped,'99999.99')
                                ELSE
                                        DEVPOS(PROW(),106);DEVOUTPICT(msaldo_ped + m_merc[i,5],'99999.99')
                                ENDIF
                                DEVPOS(PROW(),116);DEVOUT('____________________')
                        ENDIF
                        msaldo_ped := 0
                        mtot_item ++
                        SKIP
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
                IF PROW() >= 53
                        EJECT
                        mpag ++
                        cabecalho(mpag,mtit,mtipo)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,01);DEVOUT('Cod.')
                        DEVPOS(PROW(),06);DEVOUT('Cod.Barra     ')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Descricao                               ')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Referencia   ')
                        DEVPOS(PROW(),92);DEVOUT('Saldo em Estoque')
                        DEVPOS(PROW(),120);DEVOUT('Saldo Contado')
                        DEVPOS(PROW()+1,80);DEVOUT('Pedente')
                        DEVPOS(PROW(),80);DEVOUT('P')
                        DEVPOS(PROW(),88);DEVOUT('D')
                        DEVPOS(PROW(),88);DEVOUT('Dispon.')
                        DEVPOS(PROW(),99);DEVOUT('H')
                        DEVPOS(PROW(),99);DEVOUT('Haver')
                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                        DEVPOS(PROW(),107);DEVOUT('P+D+H')
                        DEVPOS(PROW(),121);DEVOUT('Fisico')
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                ENDIF
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT('Total de Item:')
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mtot_item,'9,999,999.99')
                DEVPOS(PROW()+2,00);DEVOUT(TIME())
                EJECT
                SETPRC(00,00)
        NEXT
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        RETURN NIL
ENDDO
RETURN NIL
************************************** F I M ***************************
*/
